#!/bin/bash
# Toggles Workspaces

current_workspace=$(hyprctl activewindow -j | jq -r '.workspace.id')
echo "Current workspace: $current_workspace"

case "$current_workspace" in
    "8")
        # From workspace 8 -> workspace 9 with Alacritty
        #echo "Going to workspace 9..."
        hyprctl dispatch workspace 9

        # Wait a moment for workspace switch to complete
        sleep 0.1

        # Check if Alacritty exists SPECIFICALLY on workspace 9
        if ! hyprctl clients -j | jq -e '.[] | select(.class == "Alacritty" and .workspace.id == 9)' > /dev/null; then
            #echo "Launching NEW Alacritty on workspace 9..."
            hyprctl dispatch exec alacritty
        else
            #echo "Focusing existing Alacritty on workspace 9..."
            # Focus by workspace AND class to be very specific
            local alacritty_address=$(hyprctl clients -j | jq -r '.[] | select(.class == "Alacritty" and .workspace.id == 9) | .address' | head -1)
            hyprctl dispatch focuswindow "address:$alacritty_address"
        fi
        ;;

    "9")
        # From workspace 9 -> workspace 8 with qutebrowser
        #echo "Going to workspace 8..."
        hyprctl dispatch workspace 8

        sleep 0.1

        if ! hyprctl clients -j | jq -e '.[] | select(.class == "org.qutebrowser.qutebrowser" and .workspace.id == 8)' > /dev/null; then
            #echo "Launching NEW qutebrowser on workspace 8..."
            hyprctl dispatch exec ~/.local/share/qutebrowser-env/bin/qutebrowser
        else
            #echo "Focusing existing qutebrowser on workspace 8..."
            local qb_address=$(hyprctl clients -j | jq -r '.[] | select(.class == "org.qutebrowser.qutebrowser" and .workspace.id == 8) | .address' | head -1)
            hyprctl dispatch focuswindow "address:$qb_address"
        fi
        ;;

    *)
        # From anywhere else -> workspace 8 with qutebrowser
        #echo "Going to workspace 8..."
        hyprctl dispatch workspace 8

        sleep 0.1

        if ! hyprctl clients -j | jq -e '.[] | select(.class == "org.qutebrowser.qutebrowser" and .workspace.id == 8)' > /dev/null; then
            #echo "Launching NEW qutebrowser on workspace 8..."
            hyprctl dispatch exec ~/.local/share/qutebrowser-env/bin/qutebrowser
        else
            #echo "Focusing existing qutebrowser on workspace 8..."
            local qb_address=$(hyprctl clients -j | jq -r '.[] | select(.class == "org.qutebrowser.qutebrowser" and .workspace.id == 8) | .address' | head -1)
            hyprctl dispatch focuswindow "address:$qb_address"
        fi
        ;;
esac
